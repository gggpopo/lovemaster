# æ‹çˆ±å¤§å¸ˆå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½è®¾è®¡

## æ¦‚è¿°

ä¸ºæ‹çˆ±å¤§å¸ˆå‰ç«¯é¡µé¢æ·»åŠ å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·ä¸Šä¼ èŠå¤©æˆªå›¾ï¼ŒAI è‡ªåŠ¨åˆ†ææˆªå›¾å†…å®¹å¹¶ç»™å‡ºæ‹çˆ±å»ºè®®ã€‚

## æ¶æ„è®¾è®¡

```
å‰ç«¯ (Vue 3)                    åç«¯ (Spring Boot)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatRoom.vue    â”‚            â”‚ AiController    â”‚
â”‚ - å›¾ç‰‡é€‰æ‹©æŒ‰é’®   â”‚  POST      â”‚ - æ–°å¢è§†è§‰æ¥å£  â”‚
â”‚ - å›¾ç‰‡é¢„è§ˆ      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚ - æ¥æ”¶å›¾ç‰‡+æ–‡æœ¬  â”‚
â”‚ - Base64ç¼–ç     â”‚  JSON      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        v
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚ LoveApp         â”‚
                               â”‚ - å¤šæ¨¡æ€æ¶ˆæ¯æ„å»º â”‚
                               â”‚ - å†…ç½®åˆ†ææç¤ºè¯ â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‰ç«¯æ”¹åŠ¨

### 1. ChatRoom.vue

**æ–°å¢ UI å…ƒç´ ï¼š**
- è¾“å…¥æ¡†å·¦ä¾§æ·»åŠ ã€ŒğŸ“ã€é™„ä»¶æŒ‰é’®
- è¾“å…¥æ¡†ä¸Šæ–¹æ·»åŠ å›¾ç‰‡é¢„è§ˆåŒºåŸŸ
- é¢„è§ˆå›¾ç‰‡æ”¯æŒåˆ é™¤

**æ–°å¢åŠŸèƒ½ï¼š**
- æ–‡ä»¶é€‰æ‹©å™¨ï¼ˆä»…é™å›¾ç‰‡ï¼šjpg/png/gif/webpï¼‰
- å›¾ç‰‡è¯»å–å¹¶è½¬ Base64
- æ”¯æŒæœ€å¤š 3 å¼ å›¾ç‰‡
- å‘é€æ—¶å°†å›¾ç‰‡æ•°ç»„ + æ–‡æœ¬ä¸€èµ·æäº¤

**æ ·å¼ï¼š**
- é¢„è§ˆå›¾ç‰‡ 60x60pxï¼Œåœ†è§’
- è¾“å…¥å®¹å™¨é«˜åº¦åŠ¨æ€è°ƒæ•´
- æ¶ˆæ¯æ°”æ³¡ä¸­æ˜¾ç¤ºå›¾ç‰‡ç¼©ç•¥å›¾

### 2. api/index.js

**æ–°å¢æ–¹æ³•ï¼š**
```javascript
// å¸¦å›¾ç‰‡çš„èŠå¤©ï¼ˆPOST è¯·æ±‚ï¼‰
export const chatWithLoveAppVision = (message, chatId, images, onMessage, onError) => {
  // ä½¿ç”¨ fetch + ReadableStream å®ç° SSE
  // POST JSON body: { message, chatId, images }
}
```

## åç«¯æ”¹åŠ¨

### 1. AiController.java

**æ–°å¢æ¥å£ï¼š**
```
POST /api/ai/love_app/chat/vision
Content-Type: application/json

Request Body:
{
  "message": "string",      // ç”¨æˆ·é—®é¢˜
  "chatId": "string",       // ä¼šè¯ID
  "images": ["string"]      // Base64 å›¾ç‰‡æ•°ç»„
}

Response: SSE æµå¼è¿”å›
```

### 2. LoveApp.java

**æ–°å¢å¸¸é‡ï¼š**
```java
private static final String VISION_SYSTEM_PROMPT = """
    ä½ æ˜¯ä¸€ä¸ªèŠå¤©è®°å½•åˆ†æä¸“å®¶ã€‚è¯·ä»”ç»†åˆ†æè¿™å¼ èŠå¤©æˆªå›¾ï¼Œå¹¶ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¿”å›å…¶ä¸­åŒ…å«çš„æ‰€æœ‰å¯¹è¯æ¶ˆæ¯ã€‚

    **JSONæ ¼å¼è¦æ±‚:**
    {
      "messages": [
        {
          "sender": "string",
          "direction": "string",
          "text": "string",
          "timestamp": "string",
          "has_sticker": "boolean"
        }
      ]
    }

    **åˆ¤æ–­è§„åˆ™:**
    - æ ¹æ®èŠå¤©æ°”æ³¡çš„ä½ç½®ï¼ˆé€šå¸¸å³è¾¹æ˜¯è‡ªå·±ï¼Œå·¦è¾¹æ˜¯å¯¹æ–¹ï¼‰æ¥åˆ¤æ–­ 'direction'ã€‚
    - æå–æ¯ä¸ªæ°”æ³¡å†…çš„æ‰€æœ‰æ–‡å­—ä½œä¸º 'text'ã€‚
    - å¦‚æœæ°”æ³¡æ—è¾¹æœ‰æ—¶é—´ï¼Œæå–ä¸º 'timestamp'ã€‚
    - å¦‚æœæœ‰æ— æ³•ç”¨æ–‡å­—æè¿°çš„å›¾ç‰‡ã€åŠ¨ç”»è¡¨æƒ…æˆ–è´´çº¸ï¼Œå°† 'has_sticker' è®¾ä¸º trueã€‚

    åˆ†æå®Œæˆªå›¾åï¼Œè¯·ç»“åˆç”¨æˆ·çš„é—®é¢˜ï¼Œä»¥æ‹çˆ±ä¸“å®¶çš„èº«ä»½ç»™å‡ºå»ºè®®ã€‚
    """;
```

**æ–°å¢æ–¹æ³•ï¼š**
```java
public Flux<String> doChatWithVision(String message, String chatId, List<String> images)
```

### 3. è¯·æ±‚ DTO

**æ–°å¢ç±» VisionChatRequest.javaï¼š**
```java
public class VisionChatRequest {
    private String message;
    private String chatId;
    private List<String> images;
}
```

## æŠ€æœ¯ç»†èŠ‚

### å›¾ç‰‡ä¼ è¾“
- æ ¼å¼ï¼šBase64 ç¼–ç ï¼ˆdata:image/jpeg;base64,...ï¼‰
- å¤§å°é™åˆ¶ï¼šå•å¼  5MB
- æ”¯æŒæ ¼å¼ï¼šjpg, png, gif, webp

### æ¨¡å‹è¦æ±‚
- ä½¿ç”¨æ”¯æŒè§†è§‰çš„æ¨¡å‹ï¼ˆå¦‚ doubao-seed-1-8-251228ï¼‰
- Spring AI å¤šæ¨¡æ€æ¶ˆæ¯æ„å»º

### é”™è¯¯å¤„ç†
- å›¾ç‰‡æ ¼å¼æ ¡éªŒ
- å›¾ç‰‡å¤§å°æ ¡éªŒ
- æ— å›¾ç‰‡æ—¶é™çº§ä¸ºæ™®é€šæ–‡æœ¬å¯¹è¯

## æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `yu-ai-agent-frontend/src/components/ChatRoom.vue` | ä¿®æ”¹ | æ·»åŠ å›¾ç‰‡ä¸Šä¼  UI |
| `yu-ai-agent-frontend/src/api/index.js` | ä¿®æ”¹ | æ·»åŠ  POST è¯·æ±‚æ–¹æ³• |
| `src/main/java/com/yupi/yuaiagent/controller/AiController.java` | ä¿®æ”¹ | æ·»åŠ è§†è§‰æ¥å£ |
| `src/main/java/com/yupi/yuaiagent/app/LoveApp.java` | ä¿®æ”¹ | æ·»åŠ å¤šæ¨¡æ€å¯¹è¯æ–¹æ³• |
| `src/main/java/com/yupi/yuaiagent/dto/VisionChatRequest.java` | æ–°å¢ | è¯·æ±‚ DTO |
